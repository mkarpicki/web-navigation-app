angular.module('navigationApp.services').factory('geoLocationService', ['$interval', '$rootScope',  'events', function ($interval, $rootScope, events) {

    'use strict';

    var watchPosition = function () {

        initGeoLocation();

    };

    var onGeoLocationSuccess = function (position) {

        $rootScope.$broadcast(events.POSITION_EVENT, {
            eventType: events.POSITION_EVENT_TYPES.CHANGE,
            param: position
        });

    };

    var onGeoLocationError = function (error) {

        $rootScope.$broadcast(events.POSITION_EVENT, {
            eventType: events.POSITION_EVENT_TYPES.ERROR,
            param: error
        });

    };

    var initGeoLocation = function (geoLocationObject) {

        //liebig str -> simon-dach-str
        //var steps = ["52.5218782,13.4509329","52.5261927,13.4480166","52.5263643,13.4479094","52.5265253,13.4485209","52.5275552,13.4522867","52.5282526,13.4552157","52.528435,13.4560204","52.528553,13.4567499","52.5287461,13.4577048","52.5293791,13.4605157","52.5295186,13.4612024","52.5298512,13.4625435","52.5302374,13.4639597","52.5322223,13.4727895","52.5329304,13.4760725","52.532984,13.4764588","52.5330698,13.477596","52.5334346,13.4837544","52.5334883,13.4849453","52.5340784,13.4947085","52.534132,13.4964788","52.5341642,13.4985816","52.5342071,13.4997296","52.5349581,13.5113168","52.5352371,13.5158765","52.5353336,13.5172176","52.534765,13.5176575","52.5344002,13.5179472","52.5339282,13.5182905","52.5335848,13.5185051","52.5333488,13.5186338","52.5327909,13.5187948","52.5323081,13.5188699","52.5313318,13.5189557","52.5302052,13.5190845","52.5293577,13.5190952","52.5289822,13.5191274","52.5286603,13.5191917","52.5279415,13.5192668","52.5266111,13.5193312","52.5260854,13.5193312","52.525624,13.5193956","52.5250769,13.5195029","52.5243366,13.5195565","52.5235212,13.5195243","52.5223303,13.519417","52.5194013,13.5192239","52.5165689,13.5190094","52.5145197,13.5188806","52.5118911,13.5188055","52.5109148,13.5187948","52.5103033,13.5187626","52.510035,13.5187626","52.509799,13.5187948","52.5095308,13.5187948","52.5091445,13.518827","52.5088656,13.5188699","52.5079536,13.5192239","52.507385,13.5193527","52.5057864,13.5196638","52.5050139,13.5199535","52.5045633,13.5201895","52.5037372,13.520565","52.5027609,13.5208547","52.502321,13.5210371","52.5013661,13.5213482","52.5010443,13.5214877","52.5004649,13.5216594","52.5001323,13.5217988","52.4999285,13.5219276","52.4998856,13.5213375","52.50054,13.5211337","52.5009692,13.5210049","52.5010443,13.5214877","52.5010765,13.5217452","52.5018704,13.5214555","52.5025678,13.5211337","52.5030613,13.52096"];

        //entry to stargard thru chopina -> wyszynskiego str.
        //var steps = ["53.3458509,14.9674579","53.3455431,14.9696124","53.3452749,14.9714148","53.3446956,14.9754381","53.3430648,14.9902439","53.3428609,14.9919069","53.3428288,14.9923146","53.3428288,14.9925828","53.3429253,14.9933016","53.342818,14.9933875","53.3427429,14.9935162","53.3426893,14.9936771","53.3426893,14.9939346","53.3427429,14.9941492","53.3428288,14.994278","53.3429146,14.9943423","53.3430004,14.9943638","53.3430648,14.9943531","53.3431613,14.9942887","53.3434618,14.9950933","53.3446312,14.9983764","53.3450067,14.9993527","53.345114,14.9999535","53.3450711,15.0002003","53.3450847,15.0006153","53.3450925,15.0008547","53.3452857,15.0013697","53.3452749,15.001595","53.3450282,15.0019169","53.3444059,15.0025499","53.3435047,15.0035262","53.3439553,15.0046849","53.3441591,15.0048244","53.3444059,15.005511","53.3447492,15.0063586","53.3455539,15.0085795","53.3440948,15.0101352","53.3439553,15.0102746","53.3439553,15.0102746","53.3432472,15.0110042","53.3424854,15.0113904","53.3421743,15.0113797","53.3417773,15.0113046","53.3407366,15.0110257","53.3403504,15.0146949","53.3395945,15.0213632"];

        //berlin area
        //http://localhost:3000/search?w0=Liebigstra%C3%9Fe%205,%2010247%20Berlin,%20Deutschland%7C52.51680795017993,13.4560277312994&w1=Liebigstra%C3%9Fe%2012,%2010247%20Berlin,%20Deutschland%7C52.51756528495537,13.456843122839928&w2=Liebigstra%C3%9Fe%2018A,%2010247%20Berlin,%20Deutschland%7C52.518714319686524,13.457679972052574&w3=Forckenbeckplatz,%2010247%20Berlin,%20Deutschland%7C52.519563019226574,13.458194956183434&w4=Forckenbeckplatz,%2010247%20Berlin,%20Deutschland%7C52.51919742758863,13.459847196936607&w5=Forckenbeckplatz,%2010247%20Berlin,%20Deutschland%7C52.51875349079543,13.461864218115807&w6=B%C3%A4nschstra%C3%9Fe%2048,%2010247%20Berlin,%20Deutschland%7C52.51817897769835,13.464911207556725&w7=Voigtstra%C3%9Fe%2032,%2010247%20Berlin,%20Deutschland%7C52.517878661044065,13.46900962293148&w8=Rigaer%20Stra%C3%9Fe%2043,%2010247%20Berlin,%20Deutschland%7C52.515841676514015,13.468108400702477
        //var steps = ["52.5168074,13.456029","52.5175642,13.4568456","52.5178134,13.4571147","52.5187211,13.4576491","52.5195622,13.4581447","52.5195622,13.4581447","52.5191653,13.4599686","52.5191653,13.4599686","52.5187576,13.461889","52.5187576,13.461889","52.5181912,13.4649173","52.518028,13.4657836","52.5179207,13.465848","52.5177062,13.4669638","52.5177598,13.467232","52.5174594,13.468895","52.5178798,13.4689961","52.5174594,13.468895","52.516923,13.4719741","52.5166094,13.4721936","52.5159252,13.4726822","52.5151956,13.471899","52.5158501,13.4681225"];

        //http://localhost:3000/search?w0=ulica%20Szczeci%C5%84ska,%2073-110%20Stargard,%20Polska%7C53.3423698297974,14.996670316904783&w1=ulica%20Szczeci%C5%84ska,%2073-110%20Stargard,%20Polska%7C53.34201112256967,14.999931883066893&w2=ulica%20Fryderyka%20Chopina%2019,%2073-110%20Stargard,%20Polska%7C53.343574039135376,15.0037513487041&w3=ulica%20Henryka%20Wieniawskiego%2022,%2073-110%20Stargard,%20Polska%7C53.344317044952824,15.010016988962889&w4=ulica%20Czeska%202,%2073-110%20Stargard,%20Polska%7C53.34193425634258,15.015338491648436&w5=ulica%20Szczeci%C5%84ska%2018,%2073-110%20Stargard,%20Polska%7C53.33909010853175,15.02598149701953
        var steps = ["53.3423389,14.9966605","53.3419704,14.9999857","53.3419704,14.9999857","53.3421743,15.000093","53.3422923,15.0002646","53.342936,15.0020993","53.343587,15.0037376","53.3439553,15.0046849","53.3441591,15.0048244","53.3444059,15.005511","53.3447492,15.0063586","53.3455539,15.0085795","53.3464766,15.0076354","53.3467448,15.0083542","53.346734,15.0085366","53.3465229,15.0091475","53.3462298,15.0099957","53.3454466,15.0092554","53.3452749,15.0088799","53.344284,15.0099328","53.3440948,15.0101352","53.3432472,15.0110042","53.3424854,15.0113904","53.3425713,15.013504","53.3426464,15.0139332","53.3427751,15.0143409","53.3423674,15.0148237","53.3419199,15.0153028","53.3416808,15.015564","53.3413804,15.0158322","53.3412087,15.0157142","53.3402431,15.0167549","53.3400822,15.0170338","53.3390785,15.0259778"];

        var count = 0;

        $interval(function () {

            var lat = steps[count].split(',')[0];
            var lng = steps[count].split(',')[1];

            onGeoLocationSuccess({
                coords: {
                    latitude: lat,
                    longitude: lng
                }
            });
            count++;
        }, 1000, steps.length - 1, false);
    };

    return {
        watchPosition: watchPosition
    };
}]);